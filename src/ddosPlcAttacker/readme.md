# DDoS PLC Attacker

**Program design purpose :** we want to create a DDoS attacker program which can be integrated in our [DDoS control system](https://github.com/LiuYuancheng/Python_Malwares_Repo/tree/main/src/ddosAttacker) to launch ModBus-TCP DDoS attack to jam / denial a PLC or the Modbus-TCP protocol based OT-device. This program was used for the [Cross Sword 2023 Cyber Exercise](https://www.linkedin.com/posts/natoccdcoe_crossedswords-activity-7140986334961217536-7dM5/?utm_source=share&utm_medium=member_desktop) test run Railway OT system attack demo.

[TOC]

------

### Introduction 

This PLC DDoS attack program is modified from the standard DDoS attack program `<DDoSattacker.py>` [source_code](https://github.com/LiuYuancheng/Python_Malwares_Repo/blob/main/src/ddosAttacker/ddosAttacker.py)  by adding the plc-Modbus communication module, as it inherit the standard DDoS attacker program, the DDoS C2 Hub can remote control it and use it to launch the DDoS attack to the XS2023 railway OT system `Train Control PLCs (PCL07/08)` remotely to try to interrupt the communication between the Train control HMI and PLC.

#### OT-Attack Scenario Introduction 

- The DDoS attack on PLC will show 3 attacker machines (with the Modbus DDoS attacker) sending high frequency DDoS Modbus request to jam the Modbus channel Train `Control HMI` -> `Train Control PLC` (as shown in the below diagram)
- The attack programs will send high frequency Modbus data read/write requests to the PLC to try full filling the PLC’s requests buffer queue, so when the Train control HMI sends the control request to PLC, the HMI’s request may be dropped, interrupted or got delay. 

- The effected VMs in the OT network is shown below.

![](img/attackIntro1.png)

#### Attack Background Knowledge Introduction 

**PLC operation introduction**

**Peer request handling and filtering function** : Each PLC contents 2 IP addresses whitelist to handling the Modbus data I/O from different peer :

- Allow read list: only Modbus request from IP address in the `allow read list` is allowed to get information from PLC. 
- Allow write list: only Modbus request from IP address in the `allow write list` is allowed to set PLC state. 

**Modbus Request Handling  mechanisms**

When a Modbus Request sent from HMI or other control device reach to PLC, our PLC emulator program will follow below sequence to 

1. The Modus-TCP request will be save in the OS socket buffer. 
2. PLC program (firmware) will fetch the Modbus-TCP data and put in the PLC's request queue (so the PLC can handle the control request from different peers in sequential)
3. When the PLC dequeue the request, the filter function will drop the not valid request (read request but request peer is not in allow read list or write request but peer is not in allow write list)
4. PLC will execute the Modbus request and generate the related reply for the request, then send the response to the related peer. 

The detail Modbus-TCP data flow is shown below:

![](img/attackIntro2.png)

##### Attack Detail Introduction 

Each DDoS attack program will initialize a threads pool to start 20 attack threads at same time to keep parallel sending Modbus request to the target PLC as fast as possible. All the attackers are also controlled by the attack control hub (so we can make all the attacker start at nearly same time), The DDoS attacker system work flow is shown below :

![](../../doc/img/ddos/workflow.png)

Each DDoS Attacker will also report its current attack state to the control hub regularly and fetch the user's control request. The user can start / pause each DDoS attacker's attack process from the hub web user interface. Each Attacker will have its local attack actors repository, during the attacker initialization, the attacker will import the actors from local to build its attack threads pool based on the loaded config file. For each attacker, the max thread number and the request sending speed are different based on the node's hardware spec. 

**DDoS Attack Observation**

When the attack happens, the trains operator may observe below situation :

- The PLC connection indicator on the Train-Control-HMI will show lose connection (change from green color to gray color ). 
- The data on the HMI will not update or hang for a short while. 
- He can not control the train by using the HMI or he will feel lag when control the train.

![](img/attackIntro3.png)



------

### Program Setup

To setup the DDoS Control Hub please follow this readme file:

https://github.com/LiuYuancheng/Python_Malwares_Repo/blob/main/src/ddosAttacker/readme.md

Development/Execution Environment : python 3.7.4+

Additional Lib/Software Need : 

```
pyModbusTCP==0.2.1
requests==2.28.1
```

##### Program Files List

| Program File         | Execution Env | Description                                                  |
| -------------------- | ------------- | ------------------------------------------------------------ |
| ddosAttacker.py      | python 3      | This module is used to create a multi-threads DDoS attack management program which creates a thread pool with different DDoS attack actors, The user can use the exist attack actors or plug in their customized attack actor, then config the detail attack configuration such as start/stop time in the config file. |
| ddosAttackerUtils.py | python 3      | This module is the util functions module to import different kind of DDoS attack actor into the related attack thread then hook into the DDoS attack program |
| ddosAttackCfg.txt    |               | Attacker config file.                                        |
| modBusAtkParam.json  | json          | Attack target PLC's detail information.                      |
| modbusTcpCom.py      | python        | Modbus-TCP communication module                              |
| plcServerTest.py     | python        | Test program to simulate the target PLC program.             |



------

### Program Usage

This section will introduce how to usage each program