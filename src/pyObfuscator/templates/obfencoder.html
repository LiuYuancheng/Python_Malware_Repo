{% extends 'mgmbase.html' %}

{% block title %} Threats To MITRE ATT&CK AI-LLM Mapper {% endblock %}

{% block style%} {% endblock %}

{% block mgmContent %}

<ul class="list-group">
    <li class="list-group-item">
        <h3> Obfuscate Encoder</h3>
    </li>

    <li class="list-group-item">
        <div class="row">
            <div class="col-sm-6">
                <form>
                    <div id="content_2" style="display: block">
                        <label for="contents"> Copy the python source code in below text area:</label> <p></p>
                        <code> Appended random len: </code> 
                        <input id="randomLen" name="randomLen" type="number" min="0" step="1" data-bind="value:replyNumber" value="0" style="width: 10%;"> 
                        <button type="submit" class="btn btn-success btn-sm"> Run Obfuscation </button>
                        <p></p>
                        <textarea class="form-control" style="font-family: monospace;" rows="25" id="codeContents" name="codeContents">print("hello world")# command line
                        </textarea>
                    </div>
                </form>
            </div>
            <div class="col-sm-6">

                <label for="contents"> Obfuscated result:</label> <p></p>
                <button  class="btn btn-primary btn-sm" onclick="copyCode()" > Copy Code </button>
                <button  class="btn btn-warning btn-sm" onclick="cleanCode()" > Remove Code </button>
                <form>
                    <div id="content_3" style="display: block">
                        <p></p>
                        <textarea class="form-control" style="font-family: monospace;" rows="25" id="resultContents" name="resultContents", value="123">
                        </textarea>
                    </div>
                </form>
            </div>
        </div>
    </li>
</ul>

<script>
    $(document).ready(function() {
       $('form').submit(function(event) {
          event.preventDefault();
          $.ajax({
             type: 'POST',
             url: '/encodesubmit',
             data: $('form').serialize(),
             //success: function() {
               // $('#codeContents').val('');
              //  alert('Form submitted!');
             //}
          });
       });

       var socket = io();
       socket.on('connect', function () {
        socket.emit('cli_request', { data: 'I\'m connected!' });
        });

        // Test response received from server is handled here
        socket.on('result', function (msg) {
            console.log(msg.data);
            document.getElementById('resultContents').innerHTML = msg.data 
            //$('#resultContents').append(text(msg.data).html());
            })
    });

    function copyCode() {
        // Get the text field
        var copyText = document.getElementById("resultContents");
        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices
        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);
      }

      function cleanCode() {
        // Get the text field
        var copyText = document.getElementById("resultContents");
        copyText.innerHTML=""
      }

 </script>


{% endblock %}